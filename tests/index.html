<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>PyScript Next</title>
        <script>
            addEventListener("py:ready", console.log);
        </script>
        <link rel="stylesheet" href="https://pyscript.net/unstable/core.css">
        <script type="module" src="https://pyscript.net/unstable/core.js"></script>
        <script src="mini-coi.js"></script>
    </head>
    <body>
        <button id="download" mpy-click="downloadFile">Click to Download</button>
        
        <script type="mpy">
            from js import Uint8Array, File, URL, document
            import io

            data = "Hello world, this is some text."

            def downloadFile(*args):
                encoded_data = data.encode('utf-8')
                my_stream = io.BytesIO(encoded_data)

                js_array = Uint8Array.new(len(encoded_data))
                js_array.assign(my_stream.getbuffer())

                file = File.new([js_array], "unused_file_name.txt", {type: "text/plain"})
                url = URL.createObjectURL(file)

                hidden_link = document.createElement("a")
                hidden_link.setAttribute("download", "my_other_file_name.txt")
                hidden_link.setAttribute("href", url)
                hidden_link.click()
        </script>
    </body>
</html>
